# How to build Libm on windows using SCons

## Dependency libraries:
    AOCL LibM test framework uses GNU MPFR (an open source multi-precision floating point) and GMP (GNU Multiple Precision Arithmetic) library
    Maintain following directory structure to compile libm on windows. Please note aocl-libm and mpfr folder should be place in same directory.

    Main_Directory
    +---aocl-libm
    |
    +---mpfr
        +---gmp_x64-windows
        |   +---bin
        |   |   +---gmp.dll
        |   |
        |	+---include
        |   |   +---gmp.h
        |   |   |
        |	|   +---gmpxx.h
        |   |
        |	+---lib
        |       +---gmp.lib
        |
        +---mpfr_x64-windows
            +---bin
            |   +---mpfr-6.dll
            |
            +---include
            |   +---mpf2mpfr.h
            |   |
            |   +---mpfr.h
            |
            +---lib
                +---mpfr.lib

    If you find errors in mpfr library while libm compilation or usage then follow troubleshooting section at the end.

## Installing virtualenv
    1. pip install virtualenv

## Activating virtual environment
    Use Virtual Environment to install python3 and scons inside.
    1. "<vcvarsall file path>\vcvarsall.bat" amd64
    2. cd aocl-libm
    3. virtualenv -p python .venv3
    4. .venv3\Scripts\activate
    5. pip install scons

## Start building libm library
    scons ALM_CC="<clang executable path>" ALM_CXX="<clang++ executable path>"

## Building test framework
    scons ALM_CC="<clang executable path>" ALM_CXX="<clang++ executable path>" gtests

## Building parallely
    scons ALM_CC="<clang executable path>" ALM_CXX="<clang++ executable path>" -j32 gtests

## Building with verbosity
    scons ALM_CC="<clang executable path>" ALM_CXX="<clang++ executable path>" -j32 gtests --verbose=1

## Building with debug
    scons ALM_CC=<clang executable path> ALM_CXX=<clang++ executable path> -j32 gtests --verbose=1 --debug_mode=all
    
## Building with avx512 feature
    scons ALM_CC=<clang executable path> ALM_CXX=<clang++ executable path> -j32 gtests --verbose=1 --debug_mode=all --arch_config=avx512

## To run the tests
    To run the AOCL LibM test framework.

    set PATH=%PATH%;..\mpfr\mpfr_x64-windows\bin
    set PATH=%PATH%;..\mpfr\gmp_x64-windows\bin
    build\aocl-release\gtests\cos\test_cos.exe -i f -e 1 -t perf

    Test parameters:
    Input type:
    -i (f for single precision, d for double precision)
    Vector input count:
    -e (1 for scalar, 2/4/8 for vector input variants)
    Test Type:
    -t (perf for performance, conf for conformance, accu for accuracy)
    Input count:
    -c (Integer value for number of inputs)
    Input range:
    -r (provide range: start,stop example: -r -50,50)

## Troubleshooting
    If you find errors in mpfr library while libm compilation or usage then install vcpkg freshly
    1. Download VCPKG from https://github.com/microsoft/vcpkg.git
    2. Install VCPKG, use following commands
        ○ .\vcpkg\bootstrap-vcpkg.bat
        ○ .\vcpkg.exe install yasm-tool:x86-windows
        ○ .\vcpkg.exe install gmp[core]:x64-windows
        ○ .\vcpkg.exe install mpfr:x64-windows
