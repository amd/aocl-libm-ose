# Copyright (C) 2018, AMD. All rights Reserved
#
# Author: Prem Mallappa <pmallapp@amd.com>

# Inherit global environment
Import('env')

e = env.Clone()
e.Append(
	CCFLAGS = ['-Wall', '-W', '-Wstrict-prototypes', '-Werror', 
		'-Wno-unused-but-set-parameter', '-fPIC', '-O2', 
		'-DAVX_XOP_FMA4_FMA3', '-mavx', '-mxop', '-mfma4'],
	ASFLAGS = ['-Wall', '-W', '-fPIC'],
#	 CPPPATH = [''],
#        CCFLAGS = [],
	STATIC_AND_SHARED_OBJECTS_ARE_THE_SAME = 1
	)

# The set of source files associated with this SConscript file.
source = 				\
	Glob('isa/avx/gas/*.[cS]')    + \
	Glob('isa/avx2/gas/*.[cS]')   + \
	Glob('isa/bas64/gas/*.[cS]')  + \
	Glob('ref/*.[c]')             + \
	Glob('ref/gas/*.[S]', exclude=['ref/gas/map.S'])
#	Glob('isa/avx512/gas/*.[cS]') +\

#print('lib sources' , source)

objects = e.StaticObject(source)

libm = e.StaticLibrary('amdlibm', objects)
Return('libm')
#libmso = e.SharedLibrary('amdlibm', objects)
#Return('libm', 'libmso')

